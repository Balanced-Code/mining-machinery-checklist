<!-- Loading overlay -->
@if (loading()) {
<div class="loading-overlay">
  <div class="loading-spinner"></div>
  <p>Cargando...</p>
</div>
}

<!-- Error banner -->
@if (error()) {
<div class="error-banner">
  <mat-icon>error_outline</mat-icon>
  <span>{{ error() }}</span>
</div>
}

<div class="dashboard-container">
  <!-- Título -->
  <div class="dashboard-header">
    <h1>Panel de Control</h1>
    <p class="subtitle">Resumen general de inspecciones y maquinaria</p>
  </div>

  <!-- Tarjetas de estadísticas -->
  <div class="stats-grid">
    <!-- Total de inspecciones completadas -->
    <div class="stat-card">
      <div class="stat-icon completed">
        <mat-icon>check_circle</mat-icon>
      </div>
      <div class="stat-content">
        <h3 class="stat-value">{{ totalInspeccionesCompletadas() }}</h3>
        <p class="stat-label">Inspecciones Completadas</p>
      </div>
    </div>

    <!-- Total de maquinarias -->
    <div class="stat-card">
      <div class="stat-icon machinery">
        <mat-icon>precision_manufacturing</mat-icon>
      </div>
      <div class="stat-content">
        <h3 class="stat-value">{{ totalMaquinarias() }}</h3>
        <p class="stat-label">Maquinarias Registradas</p>
      </div>
    </div>
  </div>

  <!-- Sección de últimas inspecciones -->
  <div class="recent-section">
    <div class="section-header">
      <h2>Últimas Inspecciones</h2>
      <button class="btn-view-all" (click)="verHistorialCompleto()">
        <span>Ver todo</span>
        <mat-icon>arrow_forward</mat-icon>
      </button>
    </div>

    <!-- Tabla de inspecciones -->
    @if (ultimasInspecciones().length > 0) {
    <div class="table-container">
      <table class="inspecciones-table">
        <thead>
          <tr>
            <th>SERIE</th>
            <th>MÁQUINA</th>
            <th>FECHA INICIO</th>
            <th>FECHA FIN</th>
            <th>INSPECTOR</th>
            <th>ESTADO</th>
            <th class="acciones-header">ACCIONES</th>
          </tr>
        </thead>
        <tbody>
          @for (inspeccion of ultimasInspecciones(); track inspeccion.id) {
          <tr class="table-row">
            <td>
              <span class="serie">{{ inspeccion.numSerie }}</span>
            </td>
            <td>{{ inspeccion.maquina?.nombre || '-' }}</td>
            <td>
              <div class="fecha-container">
                <div class="fecha-dia">{{ formatearFechaDia(inspeccion.fechaInicio) }}</div>
                <div class="fecha-hora">{{ formatearFechaHora(inspeccion.fechaInicio) }}</div>
              </div>
            </td>
            <td>
              <div class="fecha-container">
                <div class="fecha-dia">{{ formatearFechaDia(inspeccion.fechaFinalizacion) }}</div>
                <div class="fecha-hora">{{ formatearFechaHora(inspeccion.fechaFinalizacion) }}</div>
              </div>
            </td>
            <td>
              <div class="inspector-container">
                <div class="inspector-nombre">{{ inspeccion.inspector?.nombre || '-' }}</div>
                <div class="inspector-correo">{{ inspeccion.inspector?.correo || '-' }}</div>
              </div>
            </td>
            <td>
              <span class="badge" [class]="getBadgeClass(inspeccion)">
                {{ getEstadoText(inspeccion) }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn-icon" (click)="verDetalle(inspeccion)" title="Ver detalle">
                  <mat-icon>visibility</mat-icon>
                </button>
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    } @else {
    <div class="empty-state">
      <mat-icon class="empty-icon">inbox</mat-icon>
      <h3>No hay inspecciones registradas</h3>
      <p>Comienza creando una nueva inspección</p>
      <button class="btn-create" (click)="crearInspeccion()">
        <mat-icon>add</mat-icon>
        <span>Crear Inspección</span>
      </button>
    </div>
    }
  </div>
</div>
